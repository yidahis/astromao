<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstroMao - 离线语音识别</title>
    <!-- 引入crypto-js库用于MD5计算 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- 引入AstroMao的CSS库 -->
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <script src="/static/js/main.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎙️ AstroMao</h1>
            <p>离线语音识别 · 说话人分离 · 中英文支持</p>
        </div>

        <div class="main-content">
            <div class="upload-section" id="uploadSection">
                <h3>📁 上传音频文件或导入识别结果</h3>
                <p>拖拽音频文件到此处或点击按钮选择文件，支持多种格式并自动转换为MP3，也可以导入之前保存的JSON结果文件</p>
                <input type="file" id="fileInput" class="file-input" accept=".wav,.mp3,.m4a,.flac,.aac,.ogg">
                <input type="file" id="jsonInput" class="file-input" accept=".json">
                <input type="file" id="audioForJsonInput" class="file-input" accept=".wav,.mp3,.m4a,.flac,.aac,.ogg" style="display: none;">
                <button class="upload-btn" id="uploadBtn">选择音频文件</button>
                <button class="upload-btn import-btn" id="importBtn">📥 导入JSON结果</button>
                <button class="upload-btn select-audio-btn" id="selectAudioBtn" style="display: none;">🎵 选择对应音频</button>
                <button class="upload-btn recognize-btn" id="recognizeBtn" style="display: none;" disabled>开始识别</button>
                <button class="upload-btn history-btn" id="historyBtn">📋 历史记录</button>
                
                <div class="file-info" id="fileInfo">
                    <p><strong>文件名:</strong> <span id="fileName"></span></p>
                    <p><strong>文件大小:</strong> <span id="fileSize"></span></p>
                    <p><strong>文件类型:</strong> <span id="fileType"></span></p>
                </div>

                <div class="supported-formats">
                    音频格式: WAV, MP3, M4A, FLAC, AAC, OGG（自动转换为MP3） | 结果格式: JSON
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="processing-text">正在处理音频文件...</p>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div class="results-section" id="resultsSection">
                <div class="sentences-container">
                    <div class="sentences-header">
                        <div style="padding: 20px; background: #f8f9fa;">
                            <h3>📊 识别结果</h3>
                        </div>
                        
                        <div class="stats" id="stats">
                            <div class="stat-item">
                                <div class="stat-value" id="totalDuration">0</div>
                                <div class="stat-label">总时长 (秒)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="sentenceCount">0</div>
                                <div class="stat-label">句子数量</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="speakerCount">0</div>
                                <div class="stat-label">说话人数</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="wordCount">0</div>
                                <div class="stat-label">字符数</div>
                            </div>
                        </div>

                        <div class="full-text" style="margin: 0 20px 20px; padding: 20px;">
                            <button id="toggleFullTextBtn" onclick="toggleFullText()" style="background: #4facfe; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%;">🔽 隐藏完整文本</button>
                            <div id="fullText" style="margin-top: 15px;"></div>
                        </div>
                        
                        <div class="result-actions" id="resultActions" style="display: none; padding: 20px; background: #f8f9fa; border-top: 1px solid #eee; text-align: center;">
                            <button onclick="saveResult()" class="action-btn save-btn">💾 保存结果</button>
                            <button onclick="exportResult()" class="action-btn export-btn">📥 导出JSON</button>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: #f8f9fa; border-top: 1px solid #eee; border-bottom: 1px solid #eee;">
                            <h4 style="margin: 0;">🎯 分句结果</h4>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: #f8f9fa; border-top: 1px solid #eee; border-bottom: 1px solid #eee;">
                            <!-- 音频播放器 -->
                            <audio id="audioPlayer" controls style="width: 100%; margin-top: 15px; display: none;">
                                您的浏览器不支持音频播放。
                            </audio>
                        </div>
                        <div id="editControlPanel" style="display: none; padding: 10px 20px; background: #f1f3f5; border-bottom: 1px solid #eee;">
                            <span id="selectedCount" style="margin-right: 15px; font-weight: bold;">已选择: 0</span>
                            <button id="mergeBtn" onclick="mergeSelectedSentences()" class="action-btn merge-btn" disabled>🔄 合并选中</button>
                            <button id="mergeAndTranslateBtn" onclick="mergeAndTranslateSentences()" class="action-btn merge-translate-btn" disabled>🔄🌐 合并并翻译</button>
                            <button onclick="clearSelection()" class="action-btn clear-btn">❌ 清除选择</button>
                        </div>
                    </div>
                    <div class="sentences-list-wrapper">
                        <div id="sentencesList"></div>
                    </div>
                </div>
            </div>
                </div>
            </div>

            <!-- 历史记录模态框 -->
            <div id="historyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 80%; max-width: 800px; max-height: 80%; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>📋 识别结果历史记录</h3>
                        <button onclick="closeHistoryModal()" style="background: #ddd; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">✕</button>
                    </div>
                    <div id="historyList"></div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>